version: '3.8'

services:
    nginx:
        image: nginx:latest
        volumes:
          - ./nginx.conf:/etc/nginx/nginx.conf:ro
        ports:
          - "8500:80"
          - "8081:8080"
        networks:
          - a11y-net
          - Cloudflare

# Add load balances here
# Axe CLI Endpoint
    scan-axe-1:
      image: equalifyapp/integration-axe:latest
      environment:
        APP_PORT: 8086
        http_proxy: https://hidey.gova11y.io
        https_proxy: https://hidey.gova11y.io
        FLASK_APP: axe.py
      networks:
        - a11y-net

    scan-axe-2:
      image: equalifyapp/integration-axe:latest
      environment:
        APP_PORT: 8086
        http_proxy: https://hidey.gova11y.io
        https_proxy: https://hidey.gova11y.io
        FLASK_APP: axe.py
      networks:
        - a11y-net

    scan-axe-3:
      image: equalifyapp/integration-axe:latest
      environment:
        APP_PORT: 8086
        http_proxy: https://hidey.gova11y.io
        https_proxy: https://hidey.gova11y.io
        FLASK_APP: axe.py
      networks:
        - a11y-net

    scan-axe-4:
      image: equalifyapp/integration-axe:latest
      environment:
        APP_PORT: 8086
        http_proxy: https://hidey.gova11y.io
        https_proxy: https://hidey.gova11y.io
        FLASK_APP: axe.py
      networks:
        - a11y-net

    scan-axe-5:
      image: equalifyapp/integration-axe:latest
      environment:
        APP_PORT: 8086
        http_proxy: https://hidey.gova11y.io
        https_proxy: https://hidey.gova11y.io
        FLASK_APP: axe.py
      networks:
        - a11y-net

# Uppies Endpoint

    scan-uppies-1:
        image: equalifyapp/integration-uppies:latest
        environment:
            APP_PORT: 8085
            http_proxy: https://hidey.gova11y.io
            https_proxy: https://hidey.gova11y.io
            LOG_LEVEL: INFO
        networks:
        - a11y-net
        healthcheck:
          test: curl --fail http://0.0.0.0:8085/health || exit 1
          interval: 30s
          timeout: 10s
          retries: 3

    scan-uppies-2:
        image: equalifyapp/integration-uppies:latest
        environment:
            APP_PORT: 8085
            http_proxy: https://hidey.gova11y.io
            https_proxy: https://hidey.gova11y.io
            LOG_LEVEL: INFO
        networks:
        - a11y-net
        healthcheck:
          test: curl --fail http://127.0.0.1:8085/health || exit 1
          interval: 30s
          timeout: 10s
          retries: 3

    scan-uppies-3:
        image: equalifyapp/integration-uppies:latest
        environment:
            APP_PORT: 8085
            http_proxy: https://hidey.gova11y.io
            https_proxy: https://hidey.gova11y.io
            LOG_LEVEL: INFO
        networks:
        - a11y-net
        healthcheck:
          test: curl --fail http://127.0.0.1:8085/health || exit 1
          interval: 30s
          timeout: 10s
          retries: 3

    scan-uppies-4:
        image: equalifyapp/integration-uppies:latest
        environment:
            APP_PORT: 8085
            http_proxy: https://hidey.gova11y.io
            https_proxy: https://hidey.gova11y.io
            LOG_LEVEL: INFO
        networks:
        - a11y-net
        healthcheck:
          test: curl --fail http://127.0.0.1:8085/health || exit 1
          interval: 30s
          timeout: 10s
          retries: 3

    scan-uppies-5:
        image: equalifyapp/integration-uppies:latest
        environment:
            APP_PORT: 8085
            http_proxy: https://hidey.gova11y.io
            https_proxy: https://hidey.gova11y.io
            LOG_LEVEL: INFO
        networks:
            - a11y-net
        healthcheck:
          test: curl --fail http://localhost:8085/health || exit 1
          interval: 30s
          timeout: 10s
          retries: 3

# Tech Check Endpoint
# TODO need to finish building this...
    scan-tech-1:
        image: ghcr.io/hunter-io/wappalyzer-api:3.6
        networks:
          - a11y-net

    scan-tech-2:
        image: ghcr.io/hunter-io/wappalyzer-api:3.6
        networks:
          - a11y-net


networks:
  a11y-net:
  Cloudflare:
    external: true
